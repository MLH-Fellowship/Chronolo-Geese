!function(l,u,o,p){"use strict";function v(n,r){return new u.Observable(function(t){var e=n.on(r,function(e,n){t.next({snapshot:e,prevKey:n,event:r})},t.error.bind(t));return{unsubscribe:function(){n.off(r,e)}}}).pipe(o.delay(0))}var e;function r(e){return null!=e&&0!==e.length||(e=[l.ListenEvent.added,l.ListenEvent.removed,l.ListenEvent.changed,l.ListenEvent.moved]),e}function t(e,n){var t,r=e.snapshot.val();return"object"!=typeof r?r:p.__assign(p.__assign({},r),n?((t={})[n]=e.snapshot.key,t):null)}function i(s,e){var n,a=r(e);return n=s,u.from(n.once(l.ListenEvent.value)).pipe(o.map(function(e){return{snapshot:e,prevKey:null,event:l.ListenEvent.value}})).pipe(o.switchMap(function(e){for(var n=[u.of(e)],t=0,r=a;t<r.length;t++){var i=r[t];n.push(v(s,i))}return u.merge.apply(void 0,n).pipe(o.scan(c,[]))}),o.distinctUntilChanged())}function f(e,n){for(var t=e.length,r=0;r<t;r++)if(e[r].snapshot.key===n)return r;return-1}function c(t,n){var r=n.snapshot,e=n.prevKey,i=n.event,s=r.key,a=f(t,s),u=function(e,n){if(null==n)return 0;var t=f(e,n);return-1===t?e.length:t+1}(t,e||void 0);switch(i){case l.ListenEvent.value:if(n.snapshot&&n.snapshot.exists()){var o=null;n.snapshot.forEach(function(e){var n={snapshot:e,event:l.ListenEvent.value,prevKey:o};return o=e.key,t=p.__spreadArrays(t,[n]),!1})}return t;case l.ListenEvent.added:if(-1<a){var v=t[a-1];(v&&v.snapshot.key||null)!==e&&(t=t.filter(function(e){return e.snapshot.key!==r.key})).splice(u,0,n)}else{if(null==e)return p.__spreadArrays([n],t);(t=t.slice()).splice(u,0,n)}return t;case l.ListenEvent.removed:return t.filter(function(e){return e.snapshot.key!==r.key});case l.ListenEvent.changed:return t.map(function(e){return e.snapshot.key===s?n:e});case l.ListenEvent.moved:if(-1<a){var c=t.splice(a,1)[0];return(t=t.slice()).splice(u,0,c),t}return t;default:return t}}(e=l.ListenEvent||(l.ListenEvent={})).added="child_added",e.removed="child_removed",e.changed="child_changed",e.moved="child_moved",e.value="value",l.changeToData=t,l.fromRef=v,l.list=i,l.listVal=function(e,n){return i(e).pipe(o.map(function(e){return e.map(function(e){return t(e,n)})}))},l.object=function(e){return v(e,l.ListenEvent.value)},l.objectVal=function(e,n){return v(e,l.ListenEvent.value).pipe(o.map(function(e){return t(e,n)}))},l.stateChanges=function(n,e){var t=(e=r(e)).map(function(e){return v(n,e)});return u.merge.apply(void 0,t)}}(this.rxfire=this.rxfire||{},rxjs,rxjs.operators,tslib);
//# sourceMappingURL=rxfire-database.js.map
